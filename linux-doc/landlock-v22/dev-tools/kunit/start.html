

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; The Linux Kernel 5.10.0-rc1+ documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Using KUnit" href="usage.html" />
    <link rel="prev" title="KUnit - Unit Testing for the Linux Kernel" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.10.0-rc1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Development tools for the kernel</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sparse.html">Sparse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kcov.html">kcov: code coverage for fuzzing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gcov.html">Using gcov with the Linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kasan.html">The Kernel Address Sanitizer (KASAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ubsan.html">The Undefined Behavior Sanitizer - UBSAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kmemleak.html">Kernel Memory Leak Detector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kcsan.html">The Kernel Concurrency Sanitizer (KCSAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gdb-kernel-debugging.html">Debugging kernel and modules via gdb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kgdb.html">Using kgdb, kdb and the kernel debugger internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kselftest.html">Linux Kernel Selftests</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">KUnit - Unit Testing for the Linux Kernel</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-dependencies">Installing dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-tests-with-the-kunit-wrapper">Running tests with the KUnit Wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-tests-without-the-kunit-wrapper">Running tests without the KUnit Wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-your-first-test">Writing your first test</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">Using KUnit</a></li>
<li class="toctree-l3"><a class="reference internal" href="kunit-tool.html">kunit_tool How-To</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/index.html">API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="style.html">Test Style and Nomenclature</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#what-is-kunit">What is KUnit?</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#why-kunit">Why KUnit?</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#how-do-i-use-it">How do I use it?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Development tools for the kernel</a> &raquo;</li>
        
          <li><a href="index.html">KUnit - Unit Testing for the Linux Kernel</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/dev-tools/kunit/start.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installing-dependencies">
<h2>Installing dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this headline">¶</a></h2>
<p>KUnit has the same dependencies as the Linux kernel. As long as you can build
the kernel, you can run KUnit.</p>
</div>
<div class="section" id="running-tests-with-the-kunit-wrapper">
<h2>Running tests with the KUnit Wrapper<a class="headerlink" href="#running-tests-with-the-kunit-wrapper" title="Permalink to this headline">¶</a></h2>
<p>Included with KUnit is a simple Python wrapper which runs tests under User Mode
Linux, and formats the test results.</p>
<p>The wrapper can be run with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./tools/testing/kunit/kunit.py run
</pre></div>
</div>
<p>For more information on this wrapper (also called kunit_tool) check out the
<a class="reference internal" href="kunit-tool.html"><span class="doc">kunit_tool How-To</span></a> page.</p>
<div class="section" id="creating-a-kunitconfig">
<h3>Creating a .kunitconfig<a class="headerlink" href="#creating-a-kunitconfig" title="Permalink to this headline">¶</a></h3>
<p>If you want to run a specific set of tests (rather than those listed in the
KUnit defconfig), you can provide Kconfig options in the <code class="docutils literal notranslate"><span class="pre">.kunitconfig</span></code> file.
This file essentially contains the regular Kernel config, with the specific
test targets as well. The <code class="docutils literal notranslate"><span class="pre">.kunitconfig</span></code> should also contain any other config
options required by the tests.</p>
<p>A good starting point for a <code class="docutils literal notranslate"><span class="pre">.kunitconfig</span></code> is the KUnit defconfig:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PATH_TO_LINUX_REPO</span>
cp arch/um/configs/kunit_defconfig .kunitconfig
</pre></div>
</div>
<p>You can then add any other Kconfig options you wish, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_LIST_KUNIT_TEST=y
</pre></div>
</div>
<p><a class="reference internal" href="kunit-tool.html"><span class="doc">kunit_tool</span></a> will ensure that all config options set in
<code class="docutils literal notranslate"><span class="pre">.kunitconfig</span></code> are set in the kernel <code class="docutils literal notranslate"><span class="pre">.config</span></code> before running the tests.
It’ll warn you if you haven’t included the dependencies of the options you’re
using.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that removing something from the <code class="docutils literal notranslate"><span class="pre">.kunitconfig</span></code> will not trigger a
rebuild of the <code class="docutils literal notranslate"><span class="pre">.config</span></code> file: the configuration is only updated if the
<code class="docutils literal notranslate"><span class="pre">.kunitconfig</span></code> is not a subset of <code class="docutils literal notranslate"><span class="pre">.config</span></code>. This means that you can use
other tools (such as make menuconfig) to adjust other config options.</p>
</div>
</div>
<div class="section" id="running-the-tests-kunit-wrapper">
<h3>Running the tests (KUnit Wrapper)<a class="headerlink" href="#running-the-tests-kunit-wrapper" title="Permalink to this headline">¶</a></h3>
<p>To make sure that everything is set up correctly, simply invoke the Python
wrapper from your kernel repo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./tools/testing/kunit/kunit.py run
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may want to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">mrproper</span></code> first.</p>
</div>
<p>If everything worked correctly, you should see the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Generating .config ...
Building KUnit Kernel ...
Starting KUnit Kernel ...
</pre></div>
</div>
<p>followed by a list of tests that are run. All of them should be passing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because it is building a lot of sources for the first time, the
<code class="docutils literal notranslate"><span class="pre">Building</span> <span class="pre">KUnit</span> <span class="pre">kernel</span></code> step may take a while.</p>
</div>
</div>
</div>
<div class="section" id="running-tests-without-the-kunit-wrapper">
<h2>Running tests without the KUnit Wrapper<a class="headerlink" href="#running-tests-without-the-kunit-wrapper" title="Permalink to this headline">¶</a></h2>
<p>If you’d rather not use the KUnit Wrapper (if, for example, you need to
integrate with other systems, or use an architecture other than UML), KUnit can
be included in any kernel, and the results read out and parsed manually.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>KUnit is not designed for use in a production system, and it’s possible that
tests may reduce the stability or security of the system.</p>
</div>
<div class="section" id="configuring-the-kernel">
<h3>Configuring the kernel<a class="headerlink" href="#configuring-the-kernel" title="Permalink to this headline">¶</a></h3>
<p>In order to enable KUnit itself, you simply need to enable the <code class="docutils literal notranslate"><span class="pre">CONFIG_KUNIT</span></code>
Kconfig option (it’s under Kernel Hacking/Kernel Testing and Coverage in
menuconfig). From there, you can enable any KUnit tests you want: they usually
have config options ending in <code class="docutils literal notranslate"><span class="pre">_KUNIT_TEST</span></code>.</p>
<p>KUnit and KUnit tests can be compiled as modules: in this case the tests in a
module will be run when the module is loaded.</p>
</div>
<div class="section" id="running-the-tests-w-o-kunit-wrapper">
<h3>Running the tests (w/o KUnit Wrapper)<a class="headerlink" href="#running-the-tests-w-o-kunit-wrapper" title="Permalink to this headline">¶</a></h3>
<p>Build and run your kernel as usual. Test output will be written to the kernel
log in <a class="reference external" href="https://testanything.org/">TAP</a> format.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s possible that there will be other lines and/or data interspersed in the
TAP output.</p>
</div>
</div>
</div>
<div class="section" id="writing-your-first-test">
<h2>Writing your first test<a class="headerlink" href="#writing-your-first-test" title="Permalink to this headline">¶</a></h2>
<p>In your kernel repo let’s add some code that we can test. Create a file
<code class="docutils literal notranslate"><span class="pre">drivers/misc/example.h</span></code> with the contents:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">misc_example_add</span><span class="p">(</span><span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">);</span>
</pre></div>
</div>
<p>create a file <code class="docutils literal notranslate"><span class="pre">drivers/misc/example.c</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;linux/errno.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;example.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">misc_example_add</span><span class="p">(</span><span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now add the following lines to <code class="docutils literal notranslate"><span class="pre">drivers/misc/Kconfig</span></code>:</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="k">config</span> MISC_EXAMPLE
        <span class="nb">bool</span> <span class="s2">&quot;My example&quot;</span>
</pre></div>
</div>
<p>and the following lines to <code class="docutils literal notranslate"><span class="pre">drivers/misc/Makefile</span></code>:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">obj-$(CONFIG_MISC_EXAMPLE)</span> <span class="o">+=</span> example.o
</pre></div>
</div>
<p>Now we are ready to write the test. The test will be in
<code class="docutils literal notranslate"><span class="pre">drivers/misc/example-test.c</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;kunit/test.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;example.h&quot;</span><span class="cp"></span>

<span class="cm">/* Define the test cases. */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">misc_example_add_test_basic</span><span class="p">(</span><span class="k">struct</span> <span class="nc">kunit</span> <span class="o">*</span><span class="n">test</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">KUNIT_EXPECT_EQ</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">misc_example_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
        <span class="n">KUNIT_EXPECT_EQ</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">misc_example_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
        <span class="n">KUNIT_EXPECT_EQ</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">misc_example_add</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
        <span class="n">KUNIT_EXPECT_EQ</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">,</span> <span class="n">misc_example_add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">));</span>
        <span class="n">KUNIT_EXPECT_EQ</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">misc_example_add</span><span class="p">(</span><span class="n">INT_MAX</span><span class="p">,</span> <span class="n">INT_MIN</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">misc_example_test_failure</span><span class="p">(</span><span class="k">struct</span> <span class="nc">kunit</span> <span class="o">*</span><span class="n">test</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">KUNIT_FAIL</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="s">&quot;This test never passes.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="nc">kunit_case</span> <span class="n">misc_example_test_cases</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">KUNIT_CASE</span><span class="p">(</span><span class="n">misc_example_add_test_basic</span><span class="p">),</span>
        <span class="n">KUNIT_CASE</span><span class="p">(</span><span class="n">misc_example_test_failure</span><span class="p">),</span>
        <span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="nc">kunit_suite</span> <span class="n">misc_example_test_suite</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;misc-example&quot;</span><span class="p">,</span>
        <span class="p">.</span><span class="n">test_cases</span> <span class="o">=</span> <span class="n">misc_example_test_cases</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">kunit_test_suite</span><span class="p">(</span><span class="n">misc_example_test_suite</span><span class="p">);</span>
</pre></div>
</div>
<p>Now add the following to <code class="docutils literal notranslate"><span class="pre">drivers/misc/Kconfig</span></code>:</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="k">config</span> MISC_EXAMPLE_TEST
        <span class="nb">bool</span> <span class="s2">&quot;Test for my example&quot;</span>
        <span class="k">depends on</span> MISC_EXAMPLE <span class="o">&amp;&amp;</span> KUNIT
</pre></div>
</div>
<p>and the following to <code class="docutils literal notranslate"><span class="pre">drivers/misc/Makefile</span></code>:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">obj-$(CONFIG_MISC_EXAMPLE_TEST)</span> <span class="o">+=</span> example-test.o
</pre></div>
</div>
<p>Now add it to your <code class="docutils literal notranslate"><span class="pre">.kunitconfig</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_MISC_EXAMPLE=y
CONFIG_MISC_EXAMPLE_TEST=y
</pre></div>
</div>
<p>Now you can run the test:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./tools/testing/kunit/kunit.py run
</pre></div>
</div>
<p>You should see the following failure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
[16:08:57] [PASSED] misc-example:misc_example_add_test_basic
[16:08:57] [FAILED] misc-example:misc_example_test_failure
[16:08:57] EXPECTATION FAILED at drivers/misc/example-test.c:17
[16:08:57]      This test never passes.
...
</pre></div>
</div>
<p>Congrats! You just wrote your first KUnit test!</p>
</div>
<div class="section" id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Check out the <a class="reference internal" href="usage.html"><span class="doc">Using KUnit</span></a> page for a more
in-depth explanation of KUnit.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage.html" class="btn btn-neutral float-right" title="Using KUnit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="KUnit - Unit Testing for the Linux Kernel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>