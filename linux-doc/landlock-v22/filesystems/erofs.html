

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Enhanced Read-Only File System - EROFS &mdash; The Linux Kernel 5.10.0-rc1+ documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Second Extended Filesystem" href="ext2.html" />
    <link rel="prev" title="efivarfs - a (U)EFI variable filesystem" href="efivarfs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.10.0-rc1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Filesystems in the Linux kernel</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#core-vfs-documentation">Core VFS documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#filesystem-support-layers">Filesystem support layers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#filesystems">Filesystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="9p.html">v9fs: Plan 9 Resource Sharing for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="adfs.html">Acorn Disc Filing System - ADFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="affs.html">Overview of Amiga Filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="afs.html">kAFS: AFS FILESYSTEM</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofs.html">autofs - how it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofs-mount-control.html">Miscellaneous Device control operations for the autofs kernel module</a></li>
<li class="toctree-l3"><a class="reference internal" href="befs.html">BeOS filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="bfs.html">BFS Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="btrfs.html">BTRFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="cifs/cifsroot.html">Mounting root file system via SMB (cifs.ko)</a></li>
<li class="toctree-l3"><a class="reference internal" href="ceph.html">Ceph Distributed File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="coda.html">Coda Kernel-Venus Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="configfs.html">Configfs - Userspace-driven Kernel Object Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="cramfs.html">Cramfs - cram a filesystem onto a small ROM</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugfs.html">DebugFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="dlmfs.html">DLMFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="ecryptfs.html">eCryptfs: A stacked cryptographic filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="efivarfs.html">efivarfs - a (U)EFI variable filesystem</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Enhanced Read-Only File System - EROFS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mount-options">Mount options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#on-disk-details">On-disk details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ext2.html">The Second Extended Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext2.html#options">Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext2.html#specification">Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext2.html#references">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext3.html">Ext3 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="f2fs.html">WHAT IS Flash-Friendly File System (F2FS)?</a></li>
<li class="toctree-l3"><a class="reference internal" href="gfs2.html">Global File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="gfs2-uevents.html">uevents and GFS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="gfs2-glocks.html">Glock internal locking rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="hfs.html">Macintosh HFS Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="hfsplus.html">Macintosh HFSPlus Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="hpfs.html">Read/Write HPFS 2.09</a></li>
<li class="toctree-l3"><a class="reference internal" href="fuse.html">FUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="fuse-io.html">Fuse I/O Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="inotify.html">Inotify - A Powerful yet Simple File Change Notification System</a></li>
<li class="toctree-l3"><a class="reference internal" href="isofs.html">ISO9660 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="nilfs2.html">NILFS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntfs.html">The Linux NTFS filesystem driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ocfs2.html">OCFS2 filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ocfs2-online-filecheck.html">OCFS2 file system - online file check</a></li>
<li class="toctree-l3"><a class="reference internal" href="omfs.html">Optimized MPEG Filesystem (OMFS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="orangefs.html">ORANGEFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="overlayfs.html">Overlay Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="proc.html">The /proc Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="qnx6.html">The QNX6 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ramfs-rootfs-initramfs.html">Ramfs, rootfs and initramfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay.html">relay interface (formerly relayfs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="romfs.html">ROMFS - ROM File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="spufs/index.html">SPU Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="squashfs.html">Squashfs 4.0 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysfs.html">sysfs - _The_ filesystem for exporting kernel objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysv-fs.html">SystemV Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="tmpfs.html">Tmpfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubifs.html">UBI File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubifs-authentication.html">UBIFS Authentication Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="udf.html">UDF file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="virtiofs.html">virtiofs: virtio-fs host&lt;-&gt;guest shared file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="vfat.html">VFAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfs-delayed-logging-design.html">XFS Delayed Logging Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfs-self-describing-metadata.html">XFS Self Describing Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="zonefs.html">ZoneFS - Zone filesystem for Zoned block devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Filesystems in the Linux kernel</a> &raquo;</li>
        
      <li>Enhanced Read-Only File System - EROFS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/filesystems/erofs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enhanced-read-only-file-system-erofs">
<h1>Enhanced Read-Only File System - EROFS<a class="headerlink" href="#enhanced-read-only-file-system-erofs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>EROFS file-system stands for Enhanced Read-Only File System. Different
from other read-only file systems, it aims to be designed for flexibility,
scalability, but be kept simple and high performance.</p>
<p>It is designed as a better filesystem solution for the following scenarios:</p>
<blockquote>
<div><ul class="simple">
<li><p>read-only storage media or</p></li>
<li><p>part of a fully trusted read-only solution, which means it needs to be
immutable and bit-for-bit identical to the official golden image for
their releases due to security and other considerations and</p></li>
<li><p>hope to save some extra storage space with guaranteed end-to-end performance
by using reduced metadata and transparent file compression, especially
for those embedded devices with limited memory (ex, smartphone);</p></li>
</ul>
</div></blockquote>
<p>Here is the main features of EROFS:</p>
<blockquote>
<div><ul>
<li><p>Little endian on-disk design;</p></li>
<li><p>Currently 4KB block size (nobh) and therefore maximum 16TB address space;</p></li>
<li><p>Metadata &amp; data could be mixed by design;</p></li>
<li><p>2 inode versions for different requirements:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 17%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Inode metadata size</p></td>
<td><p>32 bytes</p></td>
<td><p>64 bytes</p></td>
</tr>
<tr class="row-odd"><td><p>Max file size</p></td>
<td><p>4 GB</p></td>
<td><p>16 EB (also limited by max. vol size)</p></td>
</tr>
<tr class="row-even"><td><p>Max uids/gids</p></td>
<td><p>65536</p></td>
<td><p>4294967296</p></td>
</tr>
<tr class="row-odd"><td><p>File change time</p></td>
<td><p>no</p></td>
<td><p>yes (64 + 32-bit timestamp)</p></td>
</tr>
<tr class="row-even"><td><p>Max hardlinks</p></td>
<td><p>65536</p></td>
<td><p>4294967296</p></td>
</tr>
<tr class="row-odd"><td><p>Metadata reserved</p></td>
<td><p>4 bytes</p></td>
<td><p>14 bytes</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>Support extended attributes (xattrs) as an option;</p></li>
<li><p>Support xattr inline and tail-end data inline for all files;</p></li>
<li><p>Support POSIX.1e ACLs by using xattrs;</p></li>
<li><p>Support transparent file compression as an option:
LZ4 algorithm with 4 KB fixed-sized output compression for high performance.</p></li>
</ul>
</div></blockquote>
<p>The following git tree provides the file system user-space tools under
development (ex, formatting tool mkfs.erofs):</p>
<ul class="simple">
<li><p>git://git.kernel.org/pub/scm/linux/kernel/git/xiang/erofs-utils.git</p></li>
</ul>
<p>Bugs and patches are welcome, please kindly help us and send to the following
linux-erofs mailing list:</p>
<ul class="simple">
<li><p>linux-erofs mailing list   &lt;<a class="reference external" href="mailto:linux-erofs&#37;&#52;&#48;lists&#46;ozlabs&#46;org">linux-erofs<span>&#64;</span>lists<span>&#46;</span>ozlabs<span>&#46;</span>org</a>&gt;</p></li>
</ul>
</div>
<div class="section" id="mount-options">
<h2>Mount options<a class="headerlink" href="#mount-options" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>(no)user_xattr</p></td>
<td><p>Setup Extended User Attributes. Note: xattr is enabled
by default if CONFIG_EROFS_FS_XATTR is selected.</p></td>
</tr>
<tr class="row-even"><td><p>(no)acl</p></td>
<td><p>Setup POSIX Access Control List. Note: acl is enabled
by default if CONFIG_EROFS_FS_POSIX_ACL is selected.</p></td>
</tr>
<tr class="row-odd"><td><p>cache_strategy=%s</p></td>
<td><p>Select a strategy for cached decompression from now on:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 82%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>disabled</p></td>
<td><p>In-place I/O decompression only;</p></td>
</tr>
<tr class="row-even"><td><p>readahead</p></td>
<td><p>Cache the last incomplete compressed physical
cluster for further reading. It still does
in-place I/O decompression for the rest
compressed physical clusters;</p></td>
</tr>
<tr class="row-odd"><td><p>readaround</p></td>
<td><p>Cache the both ends of incomplete compressed
physical clusters for further reading.
It still does in-place I/O decompression
for the rest compressed physical clusters.</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="on-disk-details">
<h2>On-disk details<a class="headerlink" href="#on-disk-details" title="Permalink to this headline">¶</a></h2>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>Different from other read-only file systems, an EROFS volume is designed
to be as simple as possible:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                              |-&gt; aligned with the block size
 ____________________________________________________________
| |SB| | ... | Metadata | ... | Data | Metadata | ... | Data |
|_|__|_|_____|__________|_____|______|__________|_____|______|
0 +1K
</pre></div>
</div>
<p>All data areas should be aligned with the block size, but metadata areas
may not. All metadatas can be now observed in two different spaces (views):</p>
<blockquote>
<div><ol class="arabic">
<li><p>Inode metadata space</p>
<p>Each valid inode should be aligned with an inode slot, which is a fixed
value (32 bytes) and designed to be kept in line with compact inode size.</p>
<dl class="simple">
<dt>Each inode can be directly found with the following formula:</dt><dd><p>inode offset = meta_blkaddr * block_size + 32 * nid</p>
</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                            |-&gt; aligned with 8B
                                    |-&gt; followed closely
+ meta_blkaddr blocks                                      |-&gt; another slot
_____________________________________________________________________
|  ...   | inode |  xattrs  | extents  | data inline | ... | inode ...
|________|_______|(optional)|(optional)|__(optional)_|_____|__________
        |-&gt; aligned with the inode slot size
            .                   .
            .                         .
        .                              .
        .                                    .
    .                                         .
    .                                              .
.____________________________________________________|-&gt; aligned with 4B
| xattr_ibody_header | shared xattrs | inline xattrs |
|____________________|_______________|_______________|
|-&gt;    12 bytes    &lt;-|-&gt;x * 4 bytes&lt;-|               .
                    .                .                 .
                .                      .                   .
        .                           .                     .
    ._______________________________.______________________.
    | id | id | id | id |  ... | id | ent | ... | ent| ... |
    |____|____|____|____|______|____|_____|_____|____|_____|
                                    |-&gt; aligned with 4B
                                                |-&gt; aligned with 4B
</pre></div>
</div>
<p>Inode could be 32 or 64 bytes, which can be distinguished from a common
field which all inode versions have – i_format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> __________________               __________________
|     i_format     |             |     i_format     |
|__________________|             |__________________|
|        ...       |             |        ...       |
|                  |             |                  |
|__________________| 32 bytes    |                  |
                                 |                  |
                                 |__________________| 64 bytes
</pre></div>
</div>
<p>Xattrs, extents, data inline are followed by the corresponding inode with
proper alignment, and they could be optional for different data mappings.
_currently_ total 4 valid data mappings are supported:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 3%" />
<col style="width: 97%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0</p></td>
<td><p>flat file data without data inline (no extent);</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>fixed-sized output data compression (with non-compacted indexes);</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>flat file data with tail packing data inline (no extent);</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>fixed-sized output data compression (with compacted indexes, v5.3+).</p></td>
</tr>
</tbody>
</table>
<p>The size of the optional xattrs is indicated by i_xattr_count in inode
header. Large xattrs or xattrs shared by many different files can be
stored in shared xattrs metadata rather than inlined right after inode.</p>
</li>
<li><p>Shared xattrs metadata space</p>
<p>Shared xattrs space is similar to the above inode space, started with
a specific block indicated by xattr_blkaddr, organized one by one with
proper align.</p>
<dl class="simple">
<dt>Each share xattr can also be directly found by the following formula:</dt><dd><p>xattr offset = xattr_blkaddr * block_size + 4 * xattr_id</p>
</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                    |-&gt; aligned by  4 bytes
+ xattr_blkaddr blocks                     |-&gt; aligned with 4 bytes
_________________________________________________________________________
|  ...   | xattr_entry |  xattr data | ... |  xattr_entry | xattr data  ...
|________|_____________|_____________|_____|______________|_______________
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="directories">
<h3>Directories<a class="headerlink" href="#directories" title="Permalink to this headline">¶</a></h3>
<p>All directories are now organized in a compact on-disk format. Note that
each directory block is divided into index and name areas in order to support
random file lookup, and all directory entries are _strictly_ recorded in
alphabetical order in order to support improved prefix binary search
algorithm (could refer to the related source code).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                ___________________________
                /                           |
            /              ______________|________________
            /              /              | nameoff1       | nameoffN-1
____________.______________._______________v________________v__________
| dirent | dirent | ... | dirent | filename | filename | ... | filename |
|___.0___|____1___|_____|___N-1__|____0_____|____1_____|_____|___N-1____|
    \                           ^
    \                          |                           * could have
    \                         |                             trailing &#39;\0&#39;
        \________________________| nameoff0

                            Directory block
</pre></div>
</div>
<p>Note that apart from the offset of the first filename, nameoff0 also indicates
the total number of directory entries in this block since it is no need to
introduce another on-disk field at all.</p>
</div>
<div class="section" id="compression">
<h3>Compression<a class="headerlink" href="#compression" title="Permalink to this headline">¶</a></h3>
<p>Currently, EROFS supports 4KB fixed-sized output transparent file compression,
as illustrated below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>        |---- Variant-Length Extent ----|-------- VLE --------|----- VLE -----
        clusterofs                      clusterofs            clusterofs
        |                               |                     |   logical data
_________v_______________________________v_____________________v_______________
... |    .        |             |        .    |             |  .          | ...
____|____.________|_____________|________.____|_____________|__.__________|____
    |-&gt; cluster &lt;-|-&gt; cluster &lt;-|-&gt; cluster &lt;-|-&gt; cluster &lt;-|-&gt; cluster &lt;-|
        size          size          size          size          size
        .                             .                .                   .
        .                       .               .                  .
            .                  .              .                .
    _______._____________._____________._____________._____________________
        ... |             |             |             | ... physical data
    _______|_____________|_____________|_____________|_____________________
            |-&gt; cluster &lt;-|-&gt; cluster &lt;-|-&gt; cluster &lt;-|
                size          size          size
</pre></div>
</div>
<p>Currently each on-disk physical cluster can contain 4KB (un)compressed data
at most. For each logical cluster, there is a corresponding on-disk index to
describe its cluster type, physical cluster address, etc.</p>
<p>See “struct z_erofs_vle_decompressed_index” in erofs_fs.h for more details.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ext2.html" class="btn btn-neutral float-right" title="The Second Extended Filesystem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="efivarfs.html" class="btn btn-neutral float-left" title="efivarfs - a (U)EFI variable filesystem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>