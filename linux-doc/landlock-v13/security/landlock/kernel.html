

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Landlock: kernel documentation &mdash; The Linux Kernel 5.4.0-rc3+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Linux Sound Subsystem Documentation" href="../../sound/index.html" />
    <link rel="prev" title="Landlock: userspace documentation" href="user.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.4.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ioctl/index.html">IOCTLs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Security Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../credentials.html">Credentials in Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../IMA-templates.html">IMA Template Management Mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keys/index.html">Kernel Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lsm.html">Linux Security Modules: General Security Hooks for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lsm-development.html">Linux Security Module Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sak.html">Linux Secure Attention Key (SAK) handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SCTP.html">SCTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../self-protection.html">Kernel Self-Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../siphash.html">SipHash - a short input PRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../siphash.html#halfsiphash-siphash-s-insecure-younger-cousin">HalfSipHash - SipHash’s insecure younger cousin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tpm/index.html">Trusted Platform Module documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Landlock LSM: programmatic access control</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="user.html">Landlock: userspace documentation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Landlock: kernel documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ebpf-properties">eBPF properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#guiding-principles">Guiding principles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#landlock-domain">Landlock domain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lsm-hooks">LSM hooks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#questions-and-answers">Questions and answers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mic/index.html">Intel Many Integrated Core (MIC) architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Security Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Landlock LSM: programmatic access control</a> &raquo;</li>
        
      <li>Landlock: kernel documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/security/landlock/kernel.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="landlock-kernel-documentation">
<h1>Landlock: kernel documentation<a class="headerlink" href="#landlock-kernel-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ebpf-properties">
<h2>eBPF properties<a class="headerlink" href="#ebpf-properties" title="Permalink to this headline">¶</a></h2>
<p>To get an expressive language while still being safe and small, Landlock is
based on eBPF. Landlock should be usable by untrusted processes and must
therefore expose a minimal attack surface. The eBPF bytecode is minimal,
powerful, widely used and designed to be used by untrusted applications. Thus,
reusing the eBPF support in the kernel enables a generic approach while
minimizing new code.</p>
<p>An eBPF program has access to an eBPF context containing some fields used to
inspect the current object. These arguments may be used directly (e.g. raw
value) or passed to helper functions according to their types (e.g. pointer).
It is then possible to do complex access checks without race conditions or
inconsistent evaluation (i.e.  <a class="reference external" href="https://www.ndss-symposium.org/ndss2003/traps-and-pitfalls-practical-problems-system-call-interposition-based-security-tools/">incorrect mirroring of the OS code and state</a>).</p>
<p>A Landlock hook describes a particular access type.  For now, there is one hook
dedicated to ptrace related operations: <code class="docutils literal notranslate"><span class="pre">BPF_LANDLOCK_PTRACE</span></code>.  A Landlock
program is tied to one hook.  This makes it possible to statically check
context accesses, potentially performed by such program, and hence prevents
kernel address leaks and ensure the right use of hook arguments with eBPF
functions.  Any user can add multiple Landlock programs per Landlock hook.
They are stacked and evaluated one after the other, starting from the most
recent program, as seccomp-bpf does with its filters.  Underneath, a hook is an
abstraction over a set of LSM hooks.</p>
</div>
<div class="section" id="guiding-principles">
<h2>Guiding principles<a class="headerlink" href="#guiding-principles" title="Permalink to this headline">¶</a></h2>
<div class="section" id="unprivileged-use">
<h3>Unprivileged use<a class="headerlink" href="#unprivileged-use" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>As far as possible, Landlock helpers and contexts should be <em>designed</em> to be
usable by unprivileged programs while following the system security policy
enforced by other access control mechanisms (e.g. DAC, LSM).  Indeed, a
Landlock program shall not interfere with other access-controls enforced on
the system.</li>
</ul>
<p>Because one of the Landlock’s goal is to create scoped access-control (i.e.
sandboxing), it makes sense to make it possible to have access-control-safe
programs.  This enables to avoid unneeded security risks when writing a
security policy.  We should also keep in mind that a Landlock program may be
written and loaded in the kernel by a trusted process, but applied by a
non-root (and possibly malicious) process to sandbox itself e.g., using a
sandboxer service.  This sandboxed process must not be able to leverage one of
the Landlock program applied on itself to do a privilege escalation nor to
infer data that should not be accessible otherwise (i.e. side-channels).</p>
<p>However, when justified, it should be possible to have dedicated
privileged-only program types e.g., to make a security decision based on
properties inaccessible by unprivileged processes, or to log actions with
additional metadata.  As explained above, these properties should not be
inferable from the enforced access-control.  Care must be taken to not only
focus on these programs’ context or helpers to avoid putting everything in a
root-only realm (cf. <a class="reference external" href="https://lwn.net/Articles/486306/">CAP_SYS_ADMIN: the new root</a>).</p>
<p>It should be noted that <code class="docutils literal notranslate"><span class="pre">CAP_SYS_ADMIN</span></code> is currently required for loading and
for enforcing any Landlock programs, but more fine-grained rights may be
discussed in the future.</p>
</div>
<div class="section" id="landlock-hook-and-context">
<h3>Landlock hook and context<a class="headerlink" href="#landlock-hook-and-context" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A Landlock hook shall be focused on access control on kernel objects instead
of syscall filtering (i.e. syscall arguments), which is the purpose of
seccomp-bpf.</li>
<li>A Landlock context provided by a hook shall express the minimal and more
generic interface to control an access for a kernel object.  This may be
implemented with kernel pointers used as security capabilities (i.e.
unforgeable token enabling actions on an object according to a set of
rights).</li>
<li>A hook shall guaranty that all the BPF function calls from a program are
safe.  Thus, the related Landlock context arguments shall always be of the
same type for a particular hook.  For example, a network hook could share
helpers with a file hook because of UNIX socket.  However, the same helpers
may not be compatible for a file system handle and a net handle.</li>
<li>Multiple hooks may use the same context interface.</li>
</ul>
</div>
<div class="section" id="landlock-helpers">
<h3>Landlock helpers<a class="headerlink" href="#landlock-helpers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Landlock helpers shall be as generic as possible while at the same time being
as simple as possible and following the syscall creation principles (cf.
<a class="reference internal" href="../../process/adding-syscalls.html"><span class="doc">Adding a New System Call</span></a>).</li>
<li>The only behavior change allowed on a helper is to fix a (logical) bug to
match the initial semantic.</li>
<li>Helpers shall be reentrant, i.e. only take inputs from arguments (e.g. from
the BPF context), to enable a hook to use a cache.  Future program options
might change this cache behavior.</li>
<li>It is quite easy to add new helpers to extend Landlock.  The main concern
should be about the possibility to leak information from the kernel that may
not be accessible otherwise (i.e. side-channel attack).</li>
</ul>
</div>
</div>
<div class="section" id="landlock-domain">
<h2>Landlock domain<a class="headerlink" href="#landlock-domain" title="Permalink to this headline">¶</a></h2>
<p>A Landlock domain is a set of eBPF programs.  There is a list for each
different program types that can be run on a specific Landlock hook (e.g.
ptrace).  A domain is tied to a set of subjects (i.e. tasks).</p>
<p>A Landlock program should not try (nor be able) to infer which subject is
currently enforced, but to have a unique security policy for all subjects tied
to the same domain.  This make the reasoning much easier and help avoid
pitfalls.</p>
<dl class="type">
<dt id="c.landlock_domain">
struct <code class="descname">landlock_domain</code><a class="headerlink" href="#c.landlock_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>Landlock programs enforced on a set of tasks</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_domain {
  struct landlock_prog_list *programs[_LANDLOCK_HOOK_LAST];
  refcount_t usage;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">programs</span></code></dt>
<dd>array of non-NULL <code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_prog_list</span></code> pointers</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usage</span></code></dt>
<dd>reference count to manage the object lifetime. When a task needs to
add Landlock programs and if <strong>usage</strong> is greater than 1, then the
task must duplicate <a class="reference internal" href="#c.landlock_domain" title="landlock_domain"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_domain</span></code></a> to not change the
children’s programs as well.</dd>
</dl>
<p><strong>Description</strong></p>
<p>When prepending a new program, if <a class="reference internal" href="#c.landlock_domain" title="landlock_domain"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_domain</span></code></a> is shared with
other tasks, then duplicate it and prepend the program to this new <a class="reference internal" href="#c.landlock_domain" title="landlock_domain"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">landlock_domain</span></code></a>.</p>
<dl class="function">
<dt id="c.landlock_prepend_prog">
struct <a class="reference internal" href="#c.landlock_domain" title="landlock_domain">landlock_domain</a> * <code class="descname">landlock_prepend_prog</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.landlock_domain" title="landlock_domain">landlock_domain</a> *<em>&nbsp;domain</em>, struct bpf_prog *<em>&nbsp;prog</em><span class="sig-paren">)</span><a class="headerlink" href="#c.landlock_prepend_prog" title="Permalink to this definition">¶</a></dt>
<dd><p>extend a Landlock domain with an eBPF program</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_domain</span> <span class="pre">*</span> <span class="pre">domain</span></code></dt>
<dd>domain to copy and extend with <strong>prog</strong>. This domain must not be
modified by another function than this one to guarantee domain
immutability.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">bpf_prog</span> <span class="pre">*</span> <span class="pre">prog</span></code></dt>
<dd>non-NULL Landlock program to prepend to a copy of <strong>domain</strong>.  <strong>prog</strong>
will be owned by <a class="reference internal" href="#c.landlock_prepend_prog" title="landlock_prepend_prog"><code class="xref c c-func docutils literal notranslate"><span class="pre">landlock_prepend_prog()</span></code></a>. You can then call
bpf_prog_put(<strong>prog</strong>) after.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Prepend <strong>prog</strong> to <strong>domain</strong> if <strong>prog</strong> is not already in <strong>domain</strong>.</p>
<p>Return a copy of <strong>domain</strong> (with <strong>prog</strong> prepended) when OK. Return a pointer
error otherwise.</p>
<div class="section" id="adding-a-landlock-program-with-seccomp">
<h3>Adding a Landlock program with seccomp<a class="headerlink" href="#adding-a-landlock-program-with-seccomp" title="Permalink to this headline">¶</a></h3>
<p>The <em class="manpage">seccomp(2)</em> syscall can be used with the
<code class="docutils literal notranslate"><span class="pre">SECCOMP_PREPEND_LANDLOCK_PROG</span></code> operation to prepend a Landlock program to
the current task’s domain.</p>
<dl class="function">
<dt id="c.landlock_seccomp_prepend_prog">
int <code class="descname">landlock_seccomp_prepend_prog</code><span class="sig-paren">(</span>unsigned int<em>&nbsp;flags</em>, const int __user *<em>&nbsp;user_bpf_fd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.landlock_seccomp_prepend_prog" title="Permalink to this definition">¶</a></dt>
<dd><p>attach a Landlock program to the current task</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">flags</span></code></dt>
<dd>not used, must be 0</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">int</span> <span class="pre">__user</span> <span class="pre">*</span> <span class="pre">user_bpf_fd</span></code></dt>
<dd>file descriptor pointing to a loaded Landlock prog</dd>
</dl>
<p><strong>Description</strong></p>
<p>current-&gt;cred-&gt;security[landlock]-&gt;domain is lazily allocated. When a new
credential is created, only a pointer is copied.  When a new Landlock
program is added by a task, if there is other references to this task’s
domain, then a new allocation is made to contain an array pointing to
Landlock program lists.  This design enable low-performance impact and is
memory efficient while keeping the property of prepend-only programs.</p>
<p>For now, installing a Landlock program requires that the requesting task has
the global CAP_SYS_ADMIN. We cannot force the use of no_new_privs to not
exclude containers where a process may legitimately acquire more privileges
thanks to an SUID binary.</p>
</div>
<div class="section" id="running-a-list-of-landlock-programs">
<h3>Running a list of Landlock programs<a class="headerlink" href="#running-a-list-of-landlock-programs" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.landlock_access_denied">
bool <code class="descname">landlock_access_denied</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.landlock_domain" title="landlock_domain">landlock_domain</a> *<em>&nbsp;domain</em>, struct landlock_hook_ctx *<em>&nbsp;hook_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.landlock_access_denied" title="Permalink to this definition">¶</a></dt>
<dd><p>run Landlock programs tied to a hook</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_domain</span> <span class="pre">*</span> <span class="pre">domain</span></code></dt>
<dd>Landlock domain pointer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_hook_ctx</span> <span class="pre">*</span> <span class="pre">hook_ctx</span></code></dt>
<dd>non-NULL valid eBPF context pointer</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return true if at least one program return deny, false otherwise.</p>
</div>
</div>
<div class="section" id="lsm-hooks">
<h2>LSM hooks<a class="headerlink" href="#lsm-hooks" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.hook_ptrace_access_check">
int <code class="descname">hook_ptrace_access_check</code><span class="sig-paren">(</span>struct task_struct *<em>&nbsp;child</em>, unsigned int<em>&nbsp;mode</em><span class="sig-paren">)</span><a class="headerlink" href="#c.hook_ptrace_access_check" title="Permalink to this definition">¶</a></dt>
<dd><p>determine whether the current process may access another</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">task_struct</span> <span class="pre">*</span> <span class="pre">child</span></code></dt>
<dd>the process to be accessed</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">mode</span></code></dt>
<dd>the mode of attachment</dd>
</dl>
<p><strong>Description</strong></p>
<p>If the current task (i.e. tracer) has one or multiple BPF_LANDLOCK_PTRACE
programs, then run them with the <cite>struct landlock_context_ptrace</cite> context.
If one of these programs return LANDLOCK_RET_DENY, then deny access with
-EPERM, else allow it by returning 0.</p>
<dl class="function">
<dt id="c.hook_ptrace_traceme">
int <code class="descname">hook_ptrace_traceme</code><span class="sig-paren">(</span>struct task_struct *<em>&nbsp;parent</em><span class="sig-paren">)</span><a class="headerlink" href="#c.hook_ptrace_traceme" title="Permalink to this definition">¶</a></dt>
<dd><p>determine whether another process may trace the current one</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">task_struct</span> <span class="pre">*</span> <span class="pre">parent</span></code></dt>
<dd>the task proposed to be the tracer</dd>
</dl>
<p><strong>Description</strong></p>
<p>If the parent task (i.e. tracer) has one or multiple BPF_LANDLOCK_PTRACE
programs, then run them with the <cite>struct landlock_context_ptrace</cite> context.
If one of these programs return LANDLOCK_RET_DENY, then deny access with
-EPERM, else allow it by returning 0.</p>
</div>
<div class="section" id="questions-and-answers">
<h2>Questions and answers<a class="headerlink" href="#questions-and-answers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-a-program-does-not-return-an-errno-or-a-kill-code">
<h3>Why a program does not return an errno or a kill code?<a class="headerlink" href="#why-a-program-does-not-return-an-errno-or-a-kill-code" title="Permalink to this headline">¶</a></h3>
<p>seccomp filters can return multiple kind of code, including an errno value or a
kill signal, which may be convenient for access control.  Those return codes
are hardwired in the userland ABI.  Instead, Landlock’s approach is to return a
bitmask to allow or deny an action, which is much simpler and more generic.
Moreover, we do not really have a choice because, unlike to seccomp, Landlock
programs are not enforced at the syscall entry point but may be executed at any
point in the kernel (through LSM hooks) where an errno return code may not make
sense.  However, with this simple ABI and with the ability to call helpers,
Landlock may gain features similar to seccomp-bpf in the future while being
compatible with previous programs.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../sound/index.html" class="btn btn-neutral float-right" title="Linux Sound Subsystem Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="user.html" class="btn btn-neutral float-left" title="Landlock: userspace documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>