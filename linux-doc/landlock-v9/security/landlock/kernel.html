

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Landlock: kernel documentation &mdash; The Linux Kernel 5.2.0-rc5+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Linux Sound Subsystem Documentation" href="../../sound/index.html" />
    <link rel="prev" title="Landlock: userland documentation" href="user.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.2.0-rc5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Security Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../credentials.html">Credentials in Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../IMA-templates.html">IMA Template Management Mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keys/index.html">Kernel Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LSM.html">Linux Security Module Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SCTP.html">SCTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../self-protection.html">Kernel Self-Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tpm/index.html">Trusted Platform Module documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Landlock LSM: programmatic access control</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="user.html">Landlock: userland documentation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Landlock: kernel documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ebpf-properties">eBPF properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#guiding-principles">Guiding principles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#questions-and-answers">Questions and answers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Security Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Landlock LSM: programmatic access control</a> &raquo;</li>
        
      <li>Landlock: kernel documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/security/landlock/kernel.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="landlock-kernel-documentation">
<h1>Landlock: kernel documentation<a class="headerlink" href="#landlock-kernel-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ebpf-properties">
<h2>eBPF properties<a class="headerlink" href="#ebpf-properties" title="Permalink to this headline">¶</a></h2>
<p>To get an expressive language while still being safe and small, Landlock is
based on eBPF. Landlock should be usable by untrusted processes and must
therefore expose a minimal attack surface. The eBPF bytecode is minimal,
powerful, widely used and designed to be used by untrusted applications. Thus,
reusing the eBPF support in the kernel enables a generic approach while
minimizing new code.</p>
<p>An eBPF program has access to an eBPF context containing some fields used to
inspect the current object. These arguments can be used directly (e.g. cookie)
or passed to helper functions according to their types (e.g. inode pointer). It
is then possible to do complex access checks without race conditions or
inconsistent evaluation (i.e.  <a class="reference external" href="https://www.ndss-symposium.org/ndss2003/traps-and-pitfalls-practical-problems-system-call-interposition-based-security-tools/">incorrect mirroring of the OS code and state</a>).</p>
<p>A Landlock hook describes a particular access type.  For now, there is two
hooks dedicated to filesystem related operations: LANDLOCK_HOOK_FS_PICK and
LANDLOCK_HOOK_FS_WALK.  A Landlock program is tied to one hook.  This makes it
possible to statically check context accesses, potentially performed by such
program, and hence prevents kernel address leaks and ensure the right use of
hook arguments with eBPF functions.  Any user can add multiple Landlock
programs per Landlock hook.  They are stacked and evaluated one after the
other, starting from the most recent program, as seccomp-bpf does with its
filters.  Underneath, a hook is an abstraction over a set of LSM hooks.</p>
</div>
<div class="section" id="guiding-principles">
<h2>Guiding principles<a class="headerlink" href="#guiding-principles" title="Permalink to this headline">¶</a></h2>
<div class="section" id="unprivileged-use">
<h3>Unprivileged use<a class="headerlink" href="#unprivileged-use" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Landlock helpers and context should be usable by any unprivileged and
untrusted program while following the system security policy enforced by
other access control mechanisms (e.g. DAC, LSM).</li>
</ul>
</div>
<div class="section" id="landlock-hook-and-context">
<h3>Landlock hook and context<a class="headerlink" href="#landlock-hook-and-context" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A Landlock hook shall be focused on access control on kernel objects instead
of syscall filtering (i.e. syscall arguments), which is the purpose of
seccomp-bpf.</li>
<li>A Landlock context provided by a hook shall express the minimal and more
generic interface to control an access for a kernel object.</li>
<li>A hook shall guaranty that all the BPF function calls from a program are
safe.  Thus, the related Landlock context arguments shall always be of the
same type for a particular hook.  For example, a network hook could share
helpers with a file hook because of UNIX socket.  However, the same helpers
may not be compatible for a file system handle and a net handle.</li>
<li>Multiple hooks may use the same context interface.</li>
</ul>
</div>
<div class="section" id="landlock-helpers">
<h3>Landlock helpers<a class="headerlink" href="#landlock-helpers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Landlock helpers shall be as generic as possible while at the same time being
as simple as possible and following the syscall creation principles (cf.
<em>Documentation/adding-syscalls.txt</em>).</li>
<li>The only behavior change allowed on a helper is to fix a (logical) bug to
match the initial semantic.</li>
<li>Helpers shall be reentrant, i.e. only take inputs from arguments (e.g. from
the BPF context), to enable a hook to use a cache.  Future program options
might change this cache behavior.</li>
<li>It is quite easy to add new helpers to extend Landlock.  The main concern
should be about the possibility to leak information from the kernel that may
not be accessible otherwise (i.e. side-channel attack).</li>
</ul>
</div>
</div>
<div class="section" id="questions-and-answers">
<h2>Questions and answers<a class="headerlink" href="#questions-and-answers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-not-create-a-custom-hook-for-each-kind-of-action">
<h3>Why not create a custom hook for each kind of action?<a class="headerlink" href="#why-not-create-a-custom-hook-for-each-kind-of-action" title="Permalink to this headline">¶</a></h3>
<p>Landlock programs can handle these checks.  Adding more exceptions to the
kernel code would lead to more code complexity.  A decision to ignore a kind of
action can and should be done at the beginning of a Landlock program.</p>
</div>
<div class="section" id="why-a-program-does-not-return-an-errno-or-a-kill-code">
<h3>Why a program does not return an errno or a kill code?<a class="headerlink" href="#why-a-program-does-not-return-an-errno-or-a-kill-code" title="Permalink to this headline">¶</a></h3>
<p>seccomp filters can return multiple kind of code, including an errno value or a
kill signal, which may be convenient for access control.  Those return codes
are hardwired in the userland ABI.  Instead, Landlock’s approach is to return a
boolean to allow or deny an action, which is much simpler and more generic.
Moreover, we do not really have a choice because, unlike to seccomp, Landlock
programs are not enforced at the syscall entry point but may be executed at any
point in the kernel (through LSM hooks) where an errno return code may not make
sense.  However, with this simple ABI and with the ability to call helpers,
Landlock may gain features similar to seccomp-bpf in the future while being
compatible with previous programs.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../sound/index.html" class="btn btn-neutral float-right" title="Linux Sound Subsystem Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="user.html" class="btn btn-neutral float-left" title="Landlock: userland documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>